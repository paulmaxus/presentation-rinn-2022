---
title: "Exploiting Power BI's scheduled refresh"
author: "Max Paulus, RI @ VU Amsterdam"
format: 
    revealjs:
            code-overflow: scroll
            logo: images/VU_logo_RGB-01.png
            incremental: true
---

## Our (semi-)automised workflow

- source: REST API
- writing Python scripts to extract/transform data
- output as (related) *.csv* tables
- load into Power BI as data source
- create visuals

## A fully automised workflow

Using workflow managers:

e.g. Apache Airflow 

![](images/graph.png)

<!--- Azure Data Factory & Blob (costs?) -->

## Overkill!

![](images/arch-diag-basic.png)

## Scheduled refresh

![](images/refresh.png)


## Data source: OpenAlex

![](images/openalex_entities.png)
<!--- entities: https://i.imgur.com/FXTji65.png -->

## API specifics

- filters
    - e.g. ror, concepts, ...
- group_by parameter
    - e.g., *oa_status*, *publication_year*, ...

## In Power BI

```{.dax}
GetOAStats = (year as text, rors as list) =>
        let
            BaseUrl = "https://api.openalex.org/works",
            vOptions = [Query=[filter="authorships.institutions.ror:" & Text.Combine(rors, "|") & ",publication_year:" & year, group_by="oa_status"]],
            Source = Json.Document(Web.Contents(BaseUrl, vOptions)),
            Table = Table.FromRecords({Source})
        in
            Table,
```

## In Power BI

![](images/oa_status.png)

## In Power BI

![](images/data_model.png)

## Data source: Overton

- rate-limited, no aggregation 
- solution: history of previous years

## In Power BI

- source1 (history): .csv (*https://vunl.sharepoint.com/sites/...*)
- source2 (current year): API 

```{.dax}
Source = Table.Combine({overton_hist, overton_current}),
#"Removed Duplicates" = Table.Distinct(Source, {"policy_document_id"}),
```

## Downsides

- no storage, i.e. not feasible for larger datasets
- scheduled refresh not combinable with Python scripts (only using gateway)
- however, public reports are also not combinable with Python scripts

## Demo

<iframe title="oa_daily" width="1024" height="1060" src="https://app.powerbi.com/view?r=eyJrIjoiODBhY2NjNDAtZDI5ZC00NWU2LTg0NDAtZDgzNGQ4NDk3MDM1IiwidCI6IjQ2MmE5YzljLTJkYTYtNGJmYi1iMzE4LTBmODMwNDNmZTQ5YiIsImMiOjh9&pageName=ReportSection4805b74ddd2ca2701890" frameborder="0" allowFullScreen="true"></iframe>

## Questions?
